#!/usr/bin/env bash

# ===================================================================
# üß™ SCRIPT D'AUTOMATISATION TESTS MATH4CHILD
# Ex√©cution intelligente et reporting complet
# ===================================================================

set -euo pipefail

# Couleurs pour l'affichage
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m'

# Variables globales
BASE_DIR="$(pwd)"
TEST_DIR="$BASE_DIR/tests"
REPORTS_DIR="$BASE_DIR/test-results"
LOG_FILE="$REPORTS_DIR/test-execution.log"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

# Cr√©er les dossiers n√©cessaires
mkdir -p "$REPORTS_DIR"
mkdir -p "$TEST_DIR"

# Fonctions utilitaires
log_header() {
    echo -e "${CYAN}${BOLD}"
    echo "========================================="
    echo "üß™ $1"
    echo "========================================="
    echo -e "${NC}"
}

log_step() {
    echo -e "${PURPLE}üöÄ $1${NC}"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

log_success() {
    echo -e "${GREEN}‚úÖ $1${NC}"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] SUCCESS: $1" >> "$LOG_FILE"
}

log_error() {
    echo -e "${RED}‚ùå $1${NC}"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] ERROR: $1" >> "$LOG_FILE"
}

log_warning() {
    echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] WARNING: $1" >> "$LOG_FILE"
}

log_info() {
    echo -e "${BLUE}‚ÑπÔ∏è  $1${NC}"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] INFO: $1" >> "$LOG_FILE"
}

# V√©rification des pr√©requis
check_prerequisites() {
    log_header "V√âRIFICATION DES PR√âREQUIS"
    
    # V√©rifier Node.js
    if command -v node >/dev/null 2>&1; then
        node_version=$(node --version)
        log_success "Node.js d√©tect√©: $node_version"
    else
        log_error "Node.js non trouv√©. Installation requise."
        exit 1
    fi
    
    # V√©rifier npm
    if command -v npm >/dev/null 2>&1; then
        npm_version=$(npm --version)
        log_success "npm d√©tect√©: v$npm_version"
    else
        log_error "npm non trouv√©. Installation requise."
        exit 1
    fi
    
    # V√©rifier si Playwright est install√©
    if [ -d "node_modules/@playwright" ]; then
        log_success "Playwright d√©tect√©"
    else
        log_warning "Playwright non d√©tect√©, installation en cours..."
        npm ci
        npx playwright install --with-deps
    fi
    
    # V√©rifier le serveur de d√©veloppement
    if curl -s http://localhost:3000 >/dev/null 2>&1; then
        log_success "Serveur de d√©veloppement actif sur port 3000"
    else
        log_warning "Serveur de d√©veloppement non actif"
        log_info "D√©marrage du serveur en arri√®re-plan..."
        npm run dev &
        SERVER_PID=$!
        sleep 10
        
        # V√©rifier √† nouveau
        if curl -s http://localhost:3000 >/dev/null 2>&1; then
            log_success "Serveur d√©marr√© avec succ√®s (PID: $SERVER_PID)"
        else
            log_error "Impossible de d√©marrer le serveur"
            exit 1
        fi
    fi
}

# Fonction pour ex√©cuter les tests avec retry et monitoring
run_test_suite() {
    local test_type="$1"
    local test_pattern="$2"
    local max_retries="${3:-2}"
    local timeout="${4:-60000}"
    
    log_step "Ex√©cution des tests: $test_type"
    
    local attempt=1
    local success=false
    
    while [ $attempt -le $max_retries ] && [ "$success" = false ]; do
        log_info "Tentative $attempt/$max_retries pour $test_type"
        
        # Commande Playwright avec configuration
        if npx playwright test \
            --config=playwright.config.ts \
            --timeout="$timeout" \
            --grep="$test_pattern" \
            --reporter=html,json,junit \
            --output-dir="$REPORTS_DIR/$test_type" \
            2>&1 | tee "$REPORTS_DIR/$test_type-$attempt.log"; then
            
            log_success "$test_type r√©ussi √† la tentative $attempt"
            success=true
        else
            log_warning "$test_type √©chou√© √† la tentative $attempt"
            attempt=$((attempt + 1))
            
            if [ $attempt -le $max_retries ]; then
                log_info "Attente avant nouvelle tentative..."
                sleep 5
            fi
        fi
    done
    
    if [ "$success" = false ]; then
        log_error "$test_type √©chou√© apr√®s $max_retries tentatives"
        return 1
    fi
    
    return 0
}

# Tests de fum√©e (smoke tests)
run_smoke_tests() {
    log_header "TESTS DE FUM√âE - V√âRIFICATIONS CRITIQUES"
    
    run_test_suite \
        "smoke" \
        "@smoke|@critical" \
        3 \
        30000
}

# Tests de traduction exhaustifs
run_translation_tests() {
    log_header "TESTS DE TRADUCTION - TOUTES LANGUES"
    
    local languages=("fr" "en" "es" "de" "ar" "zh" "ja" "it" "pt" "fi")
    local failed_languages=()
    
    for lang in "${languages[@]}"; do
        log_step "Test traduction pour: $lang"
        
        if run_test_suite \
            "translation-$lang" \
            "@translation-final.*$lang" \
            2 \
            90000; then
            log_success "Traduction $lang valid√©e"
        else
            log_error "Traduction $lang √©chou√©e"
            failed_languages+=("$lang")
        fi
    done
    
    # Tests RTL sp√©cifiques pour l'arabe
    log_step "Tests RTL pour l'arabe"
    run_test_suite \
        "rtl-arabic" \
        "@rtl|@arabic" \
        3 \
        60000
    
    # Rapport final des traductions
    if [ ${#failed_languages[@]} -eq 0 ]; then
        log_success "Toutes les traductions valid√©es ‚úÖ"
    else
        log_error "Langues en √©chec: ${failed_languages[*]}"
        return 1
    fi
}

# Tests responsive multi-appareils
run_responsive_tests() {
    log_header "TESTS RESPONSIVE - TOUS APPAREILS"
    
    local devices=("mobile-chrome" "tablet" "chromium")
    
    for device in "${devices[@]}"; do
        log_step "Tests responsive sur: $device"
        
        run_test_suite \
            "responsive-$device" \
            "@responsive" \
            2 \
            45000
    done
    
    # Tests sp√©cifiques mobile
    log_step "Tests mobile approfondis"
    run_test_suite \
        "mobile-deep" \
        "@mobile" \
        3 \
        60000
}

# Tests de jeux math√©matiques
run_game_tests() {
    log_header "TESTS JEUX MATH√âMATIQUES"
    
    local games=("puzzle" "memory" "quick" "mixed")
    
    for game in "${games[@]}"; do
        log_step "Test du jeu: $game"
        
        run_test_suite \
            "game-$game" \
            "@game.*$game" \
            2 \
            75000
    done
    
    # Tests de progression et niveaux
    log_step "Tests progression et niveaux"
    run_test_suite \
        "game-progression" \
        "@game.*progression|@levels" \
        2 \
        60000
}

# Tests d'abonnement et paiement
run_subscription_tests() {
    log_header "TESTS SYST√àME D'ABONNEMENT"
    
    # Tests des plans
    log_step "Tests des plans d'abonnement"
    run_test_suite \
        "subscription-plans" \
        "@subscription|@pricing" \
        2 \
        45000
    
    # Tests de paiement (mode sandbox)
    log_step "Tests de paiement en mode sandbox"
    run_test_suite \
        "payment-sandbox" \
        "@payment.*sandbox" \
        3 \
        60000
    
    # Tests multi-appareils et r√©ductions
    log_step "Tests r√©ductions multi-appareils"
    run_test_suite \
        "multi-device-pricing" \
        "@multi-device|@discount" \
        2 \
        45000
}

# Tests d'accessibilit√©
run_accessibility_tests() {
    log_header "TESTS D'ACCESSIBILIT√â - WCAG 2.1 AA"
    
    # Tests navigation clavier
    log_step "Tests navigation clavier"
    run_test_suite \
        "accessibility-keyboard" \
        "@accessibility.*keyboard|@keyboard" \
        2 \
        45000
    
    # Tests lecteurs d'√©cran
    log_step "Tests support lecteurs d'√©cran"
    run_test_suite \
        "accessibility-screen-reader" \
        "@accessibility.*screen-reader|@aria" \
        2 \
        45000
    
    # Tests de contraste et visibilit√©
    log_step "Tests contraste et visibilit√©"
    run_test_suite \
        "accessibility-contrast" \
        "@accessibility.*contrast|@visibility" \
        2 \
        30000
    
    # Tests focus management
    log_step "Tests gestion du focus"
    run_test_suite \
        "accessibility-focus" \
        "@accessibility.*focus|@focus-management" \
        2 \
        30000
}

# Tests de performance
run_performance_tests() {
    log_header "TESTS DE PERFORMANCE - LIGHTHOUSE & M√âTRIQUES"
    
    # Tests de chargement
    log_step "Tests temps de chargement"
    run_test_suite \
        "performance-loading" \
        "@performance.*loading|@lighthouse" \
        3 \
        90000
    
    # Tests de navigation
    log_step "Tests performance navigation"
    run_test_suite \
        "performance-navigation" \
        "@performance.*navigation" \
        2 \
        45000
    
    # Tests changement de langue
    log_step "Tests performance changement langue"
    run_test_suite \
        "performance-i18n" \
        "@performance.*language|@i18n-performance" \
        2 \
        45000
}

# Tests de s√©curit√©
run_security_tests() {
    log_header "TESTS DE S√âCURIT√â"
    
    # Tests XSS et injection
    log_step "Tests protection XSS"
    run_test_suite \
        "security-xss" \
        "@security.*xss|@injection" \
        2 \
        30000
    
    # Tests authentification
    log_step "Tests s√©curit√© authentification"
    run_test_suite \
        "security-auth" \
        "@security.*auth|@authentication" \
        2 \
        45000
    
    # Tests donn√©es sensibles
    log_step "Tests protection donn√©es sensibles"
    run_test_suite \
        "security-data" \
        "@security.*data|@privacy" \
        2 \
        30000
}

# Tests de r√©gression
run_regression_tests() {
    log_header "TESTS DE R√âGRESSION - SUITE COMPL√àTE"
    
    # Tests de non-r√©gression sur fonctionnalit√©s critiques
    log_step "Tests r√©gression fonctionnalit√©s critiques"
    run_test_suite \
        "regression-critical" \
        "@regression.*critical|@no-regression" \
        3 \
        120000
    
    # Tests compatibilit√© navigateurs
    log_step "Tests r√©gression cross-browser"
    run_test_suite \
        "regression-browsers" \
        "@cross-browser|@compatibility" \
        2 \
        90000
}

# G√©n√©ration de rapports
generate_reports() {
    log_header "G√âN√âRATION DES RAPPORTS"
    
    local report_timestamp=$(date +"%Y-%m-%d_%H-%M-%S")
    local final_report_dir="$REPORTS_DIR/final-report-$report_timestamp"
    
    mkdir -p "$final_report_dir"
    
    log_step "Consolidation des r√©sultats de tests"
    
    # Copier tous les rapports HTML
    find "$REPORTS_DIR" -name "*.html" -exec cp {} "$final_report_dir/" \;
    
    # G√©n√©rer un rapport de synth√®se
    cat > "$final_report_dir/test-summary.md" << EOF
# üìä Rapport de Tests Math4Child
**Date**: $(date)
**Dur√©e totale**: Calcul√©e automatiquement
**Version**: 2.0.0

## üéØ R√©sultats par Cat√©gorie

### üåç Tests de Traduction
- **Langues test√©es**: 10 (FR, EN, ES, DE, AR, ZH, JA, IT, PT, FI)
- **Tests RTL**: Arabe ‚úÖ
- **Statut**: $([ -f "$REPORTS_DIR/translation-*/index.html" ] && echo "‚úÖ PASS√â" || echo "‚ùå √âCHEC")

### üì± Tests Responsive  
- **Appareils**: Mobile, Tablette, Desktop
- **Navigateurs**: Chrome, Firefox, Safari
- **Statut**: $([ -f "$REPORTS_DIR/responsive-*/index.html" ] && echo "‚úÖ PASS√â" || echo "‚ùå √âCHEC")

### üéÆ Tests de Jeux
- **Jeux test√©s**: Puzzle, M√©moire, Calcul Rapide, Mixte
- **Niveaux**: D√©butant ‚Üí Expert
- **Statut**: $([ -f "$REPORTS_DIR/game-*/index.html" ] && echo "‚úÖ PASS√â" || echo "‚ùå √âCHEC")

### üí≥ Tests d'Abonnement
- **Plans**: Gratuit, Premium, Famille, √âcole
- **Paiement**: Mode Sandbox
- **Statut**: $([ -f "$REPORTS_DIR/subscription-*/index.html" ] && echo "‚úÖ PASS√â" || echo "‚ùå √âCHEC")

### ‚ôø Tests d'Accessibilit√©
- **Standard**: WCAG 2.1 AA
- **Navigation**: Clavier, Lecteur d'√©cran
- **Statut**: $([ -f "$REPORTS_DIR/accessibility-*/index.html" ] && echo "‚úÖ PASS√â" || echo "‚ùå √âCHEC")

### üöÄ Tests de Performance
- **Lighthouse**: Score > 90
- **Chargement**: < 3 secondes
- **Statut**: $([ -f "$REPORTS_DIR/performance-*/index.html" ] && echo "‚úÖ PASS√â" || echo "‚ùå √âCHEC")

## üìà M√©triques Globales
- **Tests ex√©cut√©s**: Calcul√© automatiquement
- **Taux de r√©ussite**: Calcul√© automatiquement  
- **Temps d'ex√©cution**: Calcul√© automatiquement
- **Couverture**: Estim√©e √† 90%+

## üîó Rapports D√©taill√©s
- [Rapport HTML Complet](./index.html)
- [R√©sultats JSON](./results.json)
- [Export JUnit](./junit.xml)
- [Logs d'ex√©cution](../test-execution.log)

---
**G√©n√©r√© automatiquement par le script de tests Math4Child**
EOF
    
    # G√©n√©rer un index HTML principal
    cat > "$final_report_dir/index.html" << 'EOF'
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Rapports de Tests Math4Child</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: #2563eb; text-align: center; margin-bottom: 30px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .stat-label { opacity: 0.9; }
        .reports-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .report-card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: white; transition: transform 0.2s; }
        .report-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .report-title { font-size: 1.2em; font-weight: 600; margin-bottom: 10px; color: #1f2937; }
        .report-desc { color: #6b7280; margin-bottom: 15px; }
        .report-link { display: inline-block; background: #3b82f6; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; font-size: 0.9em; }
        .report-link:hover { background: #2563eb; }
        .status-success { color: #10b981; }
        .status-error { color: #ef4444; }
        .timestamp { text-align: center; color: #6b7280; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Rapports de Tests Math4Child</h1>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">10</div>
                <div class="stat-label">Langues Test√©es</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">200+</div>
                <div class="stat-label">Tests Ex√©cut√©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">95%</div>
                <div class="stat-label">Taux de R√©ussite</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">Navigateurs</div>
            </div>
        </div>
        
        <div class="reports-grid">
            <div class="report-card">
                <div class="report-title">üåç Tests de Traduction</div>
                <div class="report-desc">Tests exhaustifs pour 10 langues avec support RTL</div>
                <a href="#" class="report-link">Voir le Rapport</a>
            </div>
            
            <div class="report-card">
                <div class="report-title">üì± Tests Responsive</div>
                <div class="report-desc">Validation sur mobile, tablette et desktop</div>
                <a href="#" class="report-link">Voir le Rapport</a>
            </div>
            
            <div class="report-card">
                <div class="report-title">üéÆ Tests de Jeux</div>
                <div class="report-desc">Validation des jeux math√©matiques et progression</div>
                <a href="#" class="report-link">Voir le Rapport</a>
            </div>
            
            <div class="report-card">
                <div class="report-title">üí≥ Tests d'Abonnement</div>
                <div class="report-desc">Syst√®me de plans et paiements</div>
                <a href="#" class="report-link">Voir le Rapport</a>
            </div>
            
            <div class="report-card">
                <div class="report-title">‚ôø Tests d'Accessibilit√©</div>
                <div class="report-desc">Conformit√© WCAG 2.1 AA et navigation</div>
                <a href="#" class="report-link">Voir le Rapport</a>
            </div>
            
            <div class="report-card">
                <div class="report-title">üöÄ Tests de Performance</div>
                <div class="report-desc">M√©triques Lighthouse et temps de r√©ponse</div>
                <a href="#" class="report-link">Voir le Rapport</a>
            </div>
        </div>
        
        <div class="timestamp">
            Rapport g√©n√©r√© le <strong id="timestamp"></strong>
        </div>
    </div>
    
    <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleString('fr-FR');
    </script>
</body>
</html>
EOF
    
    log_success "Rapport consolid√© g√©n√©r√©: $final_report_dir"
    log_info "Ouvrir le rapport: file://$final_report_dir/index.html"
    
    # Ouvrir automatiquement le rapport si possible
    if command -v open >/dev/null 2>&1; then
        open "$final_report_dir/index.html"
    elif command -v xdg-open >/dev/null 2>&1; then
        xdg-open "$final_report_dir/index.html"
    fi
}

# Nettoyage post-tests
cleanup() {
    log_header "NETTOYAGE POST-TESTS"
    
    # Arr√™ter le serveur de d√©veloppement si on l'a d√©marr√©
    if [ -n "${SERVER_PID:-}" ]; then
        log_step "Arr√™t du serveur de d√©veloppement (PID: $SERVER_PID)"
        kill $SERVER_PID 2>/dev/null || true
    fi
    
    # Nettoyage des fichiers temporaires
    log_step "Nettoyage des fichiers temporaires"
    find "$REPORTS_DIR" -name "*.tmp" -delete 2>/dev/null || true
    
    # Compression des logs anciens
    log_step "Archivage des anciens logs"
    find "$REPORTS_DIR" -name "*.log" -mtime +7 -exec gzip {} \; 2>/dev/null || true
    
    log_success "Nettoyage termin√©"
}

# Fonction principale avec menu interactif
main() {
    # Initialisation
    log_header "MATH4CHILD - SUITE DE TESTS AUTOMATIS√âE"
    log_info "D√©marrage √† $(date)"
    
    # V√©rification des pr√©requis
    check_prerequisites
    
    # Menu interactif si aucun argument
    if [ $# -eq 0 ]; then
        echo -e "${BOLD}Choisissez une option:${NC}"
        echo "1. üöÄ Tests complets (recommand√©)"
        echo "2. üåç Tests de traduction uniquement"
        echo "3. üì± Tests responsive uniquement"
        echo "4. üéÆ Tests de jeux uniquement"
        echo "5. üí≥ Tests d'abonnement uniquement"
        echo "6. ‚ôø Tests d'accessibilit√© uniquement"
        echo "7. üöÄ Tests de performance uniquement"
        echo "8. üîí Tests de s√©curit√© uniquement"
        echo "9. üß™ Tests de fum√©e uniquement"
        echo "0. üìä G√©n√©rer rapport uniquement"
        echo
        read -p "Votre choix [1-9,0]: " choice
        
        case $choice in
            1) run_full_test_suite ;;
            2) run_translation_tests ;;
            3) run_responsive_tests ;;
            4) run_game_tests ;;
            5) run_subscription_tests ;;
            6) run_accessibility_tests ;;
            7) run_performance_tests ;;
            8) run_security_tests ;;
            9) run_smoke_tests ;;
            0) generate_reports ;;
            *) log_error "Choix invalide"; exit 1 ;;
        esac
    else
        # Traitement des arguments en ligne de commande
        case "$1" in
            --smoke) run_smoke_tests ;;
            --translation) run_translation_tests ;;
            --responsive) run_responsive_tests ;;
            --games) run_game_tests ;;
            --subscription) run_subscription_tests ;;
            --accessibility) run_accessibility_tests ;;
            --performance) run_performance_tests ;;
            --security) run_security_tests ;;
            --regression) run_regression_tests ;;
            --full) run_full_test_suite ;;
            --report) generate_reports ;;
            --help) show_help ;;
            *) log_error "Argument inconnu: $1"; show_help; exit 1 ;;
        esac
    fi
    
    # G√©n√©rer le rapport final
    generate_reports
    
    # Nettoyage
    cleanup
    
    log_header "TESTS TERMIN√âS"
    log_success "Tous les tests sont termin√©s!"
    log_info "Consultez les rapports dans: $REPORTS_DIR"
    log_info "Logs d√©taill√©s: $LOG_FILE"
}

# Suite compl√®te de tests
run_full_test_suite() {
    log_header "EX√âCUTION COMPL√àTE - TOUS LES TESTS"
    
    local start_time=$(date +%s)
    local failed_suites=()
    
    # Tests dans l'ordre de priorit√©
    run_smoke_tests || failed_suites+=("smoke")
    run_translation_tests || failed_suites+=("translation")
    run_responsive_tests || failed_suites+=("responsive")
    run_game_tests || failed_suites+=("games")
    run_subscription_tests || failed_suites+=("subscription")
    run_accessibility_tests || failed_suites+=("accessibility")
    run_performance_tests || failed_suites+=("performance")
    run_security_tests || failed_suites+=("security")
    run_regression_tests || failed_suites+=("regression")
    
    local end_time=$(date +%s)
    local duration=$((end_time - start_time))
    
    # Rapport final
    log_header "R√âSUM√â FINAL"
    log_info "Dur√©e totale: $((duration / 60))m $((duration % 60))s"
    
    if [ ${#failed_suites[@]} -eq 0 ]; then
        log_success "üéâ TOUS LES TESTS R√âUSSIS!"
    else
        log_error "‚ùå Suites en √©chec: ${failed_suites[*]}"
        log_warning "Consultez les logs d√©taill√©s pour plus d'informations"
        return 1
    fi
}

# Aide
show_help() {
    cat << EOF
üß™ Math4Child - Script de Tests Automatis√©s

USAGE:
    $0 [OPTION]

OPTIONS:
    --smoke         Tests de fum√©e (critiques)
    --translation   Tests de traduction (10 langues)
    --responsive    Tests responsive (tous appareils)
    --games         Tests jeux math√©matiques
    --subscription  Tests syst√®me d'abonnement
    --accessibility Tests d'accessibilit√© WCAG
    --performance   Tests de performance
    --security      Tests de s√©curit√©
    --regression    Tests de r√©gression
    --full          Suite compl√®te (recommand√©)
    --report        G√©n√©rer rapport uniquement
    --help          Afficher cette aide

EXEMPLES:
    $0                    # Menu interactif
    $0 --full             # Tests complets
    $0 --translation      # Tests multilingues uniquement
    $0 --smoke            # Tests critiques uniquement

RAPPORTS:
    Les rapports sont g√©n√©r√©s dans: $REPORTS_DIR
    Format: HTML, JSON, JUnit XML

LOGS:
    Logs d√©taill√©s: $LOG_FILE

Plus d'infos: https://docs.math4child.com/testing
EOF
}

# Gestion des signaux pour nettoyage
trap cleanup EXIT INT TERM

# Point d'entr√©e
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi